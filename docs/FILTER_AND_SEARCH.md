# 分类与筛选功能说明

## 功能概览

媒体库现在支持强大的搜索、筛选和排序功能，帮助您快速找到想看的影片。

## 主要功能

### 1. 搜索功能

**位置**: 媒体库页面顶部搜索框

**功能**:
- 支持片名关键词模糊匹配
- 实时搜索，输入即可看到结果
- 搜索结果显示在页面顶部的"筛选结果"区域

**使用方法**:
1. 在搜索框中输入影片名称的关键词（如"复仇者"）
2. 系统会自动搜索并显示包含该关键词的所有影片
3. 搜索支持中文和英文

### 2. 排序功能

**支持的排序方式**:
- **最近更新**: 按照扫描时间倒序排列（默认）
- **名称**: 按照片名字母顺序排列
- **年份**: 按照上映年份倒序排列
- **评分**: 按照评分从高到低排列

**使用方法**:
点击筛选栏中的"排序"按钮，选择想要的排序方式。

### 3. 类型筛选

**支持的类型**:
- 全部: 显示所有影片（默认）
- 电影: 仅显示电影
- 电视剧: 仅显示电视剧和剧集

**使用方法**:
点击筛选栏中的"类型"按钮，选择想要查看的类型。

### 4. 年份筛选

**功能**:
- 按照影片的上映年份进行筛选
- 显示所有有影片的年份供选择
- 可选择"不限"清除年份筛选

**使用方法**:
点击筛选栏中的"年份"按钮，选择想要查看的年份。

### 5. 类别筛选

**功能**:
- 按照影片的类别（如动作、科幻、剧情等）进行筛选
- 显示所有影片包含的类别供选择
- 可选择"不限"清除类别筛选

**使用方法**:
点击筛选栏中的"类别"按钮，选择想要查看的类别。

### 6. 组合筛选

**功能**:
多个筛选条件可以同时使用，例如：
- 搜索"星球" + 类型"电影" + 年份"2020"
- 类型"电视剧" + 类别"科幻" + 排序"评分"

**使用方法**:
1. 依次设置各个筛选条件
2. 每次设置后，筛选结果会立即更新
3. 点击"重置"按钮可清除所有筛选条件

## 界面布局

```
┌─────────────────────────────────────────────┐
│  [搜索框: 搜索片名...]        [重置]        │
│  [排序] [类型] [年份] [类别]                │
├─────────────────────────────────────────────┤
│  共 X 个结果                                │
│  ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐       │
│  │海报│ │海报│ │海报│ │海报│ │海报│       │
│  └────┘ └────┘ └────┘ └────┘ └────┘       │
│  ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐       │
│  │海报│ │海报│ │海报│ │海报│ │海报│       │
│  └────┘ └────┘ └────┘ └────┘ └────┘       │
├─────────────────────────────────────────────┤
│  继续播放 / 最近添加 / 电影 / 电视剧 ...   │
└─────────────────────────────────────────────┘
```

## 空态和错误处理

### 无筛选结果
当筛选条件过于严格，没有符合条件的影片时，会显示：
```
暂无结果
请尝试调整筛选条件
```

### 无媒体内容
当媒体库中没有任何影片时，会显示：
```
暂无媒体
请先配置文件源并点击"重新扫描"
```

## 性能优化

- **实时筛选**: 所有筛选操作在内存中完成，响应速度快
- **懒加载**: 筛选结果使用 Grid 布局，支持大量数据展示
- **稳定 key**: 使用稳定的 key 值避免不必要的重渲染

## 技术实现

### 数据流

```
用户操作
  ↓
updateFilter() - 更新筛选条件
  ↓
applyFilters() - 应用筛选逻辑
  ↓
filteredList - 筛选结果列表
  ↓
UI 更新 - 自动响应式更新
```

### 筛选逻辑

筛选按以下顺序执行：
1. 搜索关键词匹配（片名）
2. 类型筛选（电影/电视剧）
3. 年份筛选
4. 类别筛选
5. 排序

### 状态管理

所有筛选状态保存在 `MediaLibraryModel` 中：
- `filterCriteria`: 当前筛选条件
- `filteredList`: 筛选后的结果列表
- `allGenres`: 所有可选类别
- `allYears`: 所有可选年份

## 未来改进

以下功能计划在后续版本中实现：

1. **播放历史筛选**
   - 未看完：显示观看进度不到 90% 的影片
   - 最近播放：按最近播放时间排序

2. **高级筛选**
   - 评分范围筛选
   - 时长筛选
   - 多类别组合筛选

3. **搜索增强**
   - 演员名搜索
   - 导演名搜索
   - 剧情简介搜索
   - 拼音首字母搜索

4. **UI 改进**
   - 使用更好的下拉菜单组件
   - 添加筛选条件标签（可点击移除）
   - 保存常用筛选条件

5. **分页加载**
   - 大量结果时分页显示
   - 虚拟滚动优化性能

## 相关文件

- **状态管理**: `entry/src/main/ets/stores/media/MediaLibraryModel.ets`
- **UI 组件**: `entry/src/main/ets/pages/home/tabs/MediaLibraryTab.ets`
- **测试文件**: `entry/src/test/MediaLibraryFilter.test.ets`
